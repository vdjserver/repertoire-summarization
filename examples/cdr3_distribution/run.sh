# environment variable definitions
# this is similar to how the RepCalc application in VDJServer works
JobSelected=651223970338378216-242ac11b-0001-007
VDJMLFilesMetadata="5582170919522931176-242ac11c-0001-012 5508297482031731176-242ac11c-0001-012 5531962751832691176-242ac11c-0001-012 5556057518363251176-242ac11c-0001-012 5462040684253811176-242ac11c-0001-012 5483987967136371176-242ac11c-0001-012 5415569138111091176-242ac11c-0001-012 5438031817069171176-242ac11c-0001-012 5353678659375731176-242ac11c-0001-012 5385504367039091176-242ac11c-0001-012 4888576650891891176-242ac11c-0001-012 4776177356755571176-242ac11c-0001-012 4802806153990771176-242ac11c-0001-012 5729402398429811176-242ac11c-0001-012 5606050937688691176-242ac11c-0001-012 5678464086299251176-242ac11c-0001-012 5706596122088051176-242ac11c-0001-012 5806153464009331176-242ac11c-0001-012 5829861683483251176-242ac11c-0001-012 5751478530331251176-242ac11c-0001-012 5776260491629171176-242ac11c-0001-012 4941490647978611176-242ac11c-0001-012 5631477144081011176-242ac11c-0001-012 5654197521076851176-242ac11c-0001-012 4965198867452531176-242ac11c-0001-012 4988305791505011176-242ac11c-0001-012 5032973451383411176-242ac11c-0001-012 5233161877049971176-242ac11c-0001-012 5209668405940851176-242ac11c-0001-012 5185960186466931176-242ac11c-0001-012 5161307074187891176-242ac11c-0001-012 5327264610505331176-242ac11c-0001-012 5294708758401651176-242ac11c-0001-012 5257857939001971176-242ac11c-0001-012 5129867913581171176-242ac11c-0001-012 5096538967364211176-242ac11c-0001-012 5065357504795251176-242ac11c-0001-012 4860917061505651176-242ac11c-0001-012 4831968981930611176-242ac11c-0001-012 4914475303686771176-242ac11c-0001-012"
SummaryFilesMetadata="5576759260729971176-242ac11c-0001-012 5502671074873971176-242ac11c-0001-012 5524532458410611176-242ac11c-0001-012 5550559960224371176-242ac11c-0001-012 5455727082328691176-242ac11c-0001-012 5478619258016371176-242ac11c-0001-012 5409470284550771176-242ac11c-0001-012 5432749007295091176-242ac11c-0001-012 5346591963337331176-242ac11c-0001-012 5375582992585331176-242ac11c-0001-012 4881232256815731176-242ac11c-0001-012 4769219509736051176-242ac11c-0001-012 4797609243562611176-242ac11c-0001-012 5723561242907251176-242ac11c-0001-012 5599823235109491176-242ac11c-0001-012 5672064585028211176-242ac11c-0001-012 5698478633898611176-242ac11c-0001-012 5800698855543411176-242ac11c-0001-012 5824106427306611176-242ac11c-0001-012 5745938022519411176-242ac11c-0001-012 5769087896244851176-242ac11c-0001-012 4934146253902451176-242ac11c-0001-012 5624691095753331176-242ac11c-0001-012 5648614063592051176-242ac11c-0001-012 4959228862911091176-242ac11c-0001-012 4982206937944691176-242ac11c-0001-012 5024512365810291176-242ac11c-0001-012 5227836117602931176-242ac11c-0001-012 5203612502053491176-242ac11c-0001-012 5179818383233651176-242ac11c-0001-012 5155036421935731176-242ac11c-0001-012 5320049065448051176-242ac11c-0001-012 5283284145394291176-242ac11c-0001-012 5251802035114611176-242ac11c-0001-012 5122480569832051176-242ac11c-0001-012 5089323422306931176-242ac11c-0001-012 5056810519876211176-242ac11c-0001-012 4852756623643251176-242ac11c-0001-012 4824323940143731176-242ac11c-0001-012 4907431557321331176-242ac11c-0001-012"
ChangeOFilesMetadata="5588140924064371176-242ac11c-0001-012 5513709140824691176-242ac11c-0001-012 5539049447871091176-242ac11c-0001-012 5563573711131251176-242ac11c-0001-012 5467881839776371176-242ac11c-0001-012 5489614374294131176-242ac11c-0001-012 5421753891017331176-242ac11c-0001-012 5443787073245811176-242ac11c-0001-012 5360121110319731176-242ac11c-0001-012 5393450056536691176-242ac11c-0001-012 4894976152162931176-242ac11c-0001-012 4783392901812851176-242ac11c-0001-012 4808990906897011176-242ac11c-0001-012 5734942906241651176-242ac11c-0001-012 5612622237651571176-242ac11c-0001-012 5683789845746291176-242ac11c-0001-012 5712823824667251176-242ac11c-0001-012 5811779871167091176-242ac11c-0001-012 5835702839005811176-242ac11c-0001-012 5756933138797171176-242ac11c-0001-012 5786783161504371176-242ac11c-0001-012 4947417702847091176-242ac11c-0001-012 5637189450584691176-242ac11c-0001-012 5660511123001971176-242ac11c-0001-012 4970825274610291176-242ac11c-0001-012 5000932995355251176-242ac11c-0001-012 5040231946113651176-242ac11c-0001-012 5241494113604211176-242ac11c-0001-012 5215337762771571176-242ac11c-0001-012 5191758392316531176-242ac11c-0001-012 5167277078729331176-242ac11c-0001-012 5334609004581491176-242ac11c-0001-012 5302010202804851176-242ac11c-0001-012 5266018376864371176-242ac11c-0001-012 5139402740978291176-242ac11c-0001-012 5105429549666931176-242ac11c-0001-012 5072830747890291176-242ac11c-0001-012 4868519153619571176-242ac11c-0001-012 4839184526987891176-242ac11c-0001-012 4920874804957811176-242ac11c-0001-012"

# turn into bash arrays
vdjmlMeta=($VDJMLFilesMetadata)
summaryMeta=($SummaryFilesMetadata)
changeoMeta=($ChangeOFilesMetadata)

# copy test data
rm -f *.rc_out.tsv
cp ../data/tcr/*.rc_out.tsv.zip .
for file in *.rc_out.tsv.zip; do
    unzip $file
done

# create configuration file
repcalc_create_config --init study_metadata.json human TCR repcalc_config.json

# add files to input config
count=0
while [ "x${vdjmlMeta[count]}" != "x" ]
do
    filekey="file${count}"
    repcalc_create_config repcalc_config.json --file $filekey ${vdjmlMeta[count]} ${summaryMeta[count]} ${changeoMeta[count]}
    count=$(( $count + 1 ))
done

# add samples to input config
repcalc_create_config repcalc_config.json --samples ${JobSelected}

# 
repcalc_create_config repcalc_config.json --cdr3Levels "aa" --cdr3Operations "distribution" --cdr3Filters "productive"

# run repcalc
repcalc repcalc_config.json
